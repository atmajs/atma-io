!function(){var x={},U={},i={},o={},N={},B={},$={},W={},u={},G={},z={},J={},X={},m={},Z={},h={},d={},p={},y={},g={},f={},w={},n={},K={},A={},Q={},V={},j={},v={},Y={},_={},ee={},b={},O={},te={};function e(e){return null!=e&&"object"==typeof e&&e.constructor===Object}function t(e){return null!=e&&"object"==typeof e&&e.constructor===Object}function r(e,t){if(null==e)return e;for(var r=e.length,n=-1;++n<r&&!1!==t(e[n],n););return e}function s(e){return Array.isArray(e)}function c(e){return null!=e&&"object"==typeof e&&e.constructor===Object}function a(e){return null!=e&&"object"==typeof e&&e.constructor===Object}!function(){var e=null!=z?z:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.io=e.logger=e.global=void 0;var r=global,r=(e.global=r).logger||require("atma-logger");e.logger=r;function n(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.io={},n(z)&&n(t.exports)?Object.assign(z,t.exports):z=t.exports}(),function(){var t=null!=U?U:{},e={exports:t};Object.defineProperty(t,"__esModule",{value:!0}),t.Env=void 0;var r,n=require("atma-utils"),o=z,i=require("os"),s=null!==(a=process.mainModule)&&void 0!==a?a:require.main,c=(r=f(r=l(r=s.filename)),new n.class_Uri(r),p(s.path)),u=process.platform,a=p(process.cwd());function l(e){return e.replace(/\\/g,"/")}function f(e,t){return void 0===t&&(t="file"),/^\w+:\/\//.test(e)?e:t+"://"+e}function p(e){return!1===(e=l(e)).endsWith("/")&&(e+="/"),e=f(e),new n.class_Uri(e)}function h(e){return null!=e&&"object"==typeof e&&e.constructor===Object}t.Env={settings:{},cwd:a.toString(),applicationDir:c,currentDir:a,tmpDir:p(i.tmpdir()),newLine:i.EOL,getTmpPath:function(e){return t.Env.tmpDir.combine(Date.now()+"-"+(1e4*Math.random()|0)+"-"+e).toString()},get appdataDir(){var e;switch(u){case"win32":case"win64":e=process.env.APPDATA||process.env.HOME;break;default:e=process.env.HOME}if(null==e)return o.logger.error("<io.env> Unknown AppData Dir"),Object.defineProperty(this,"appdataDir",{value:this.applicationDir}),this.applicationDir;var t=p(e);return"darwin"===u&&(t=t.combine("Library/Application Support/")),Object.defineProperty(this,"appdataDir",{value:t}),t}},h(U)&&h(e.exports)?Object.assign(U,e.exports):U=e.exports}(),function(){var n,e=null!=G?G:{},t={exports:e},r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.Watcher=void 0;var o=require("fs"),i=z,s=require("atma-utils"),c="change",u={};e.Watcher={watch:function(e,t){u[e]?u[e].on(c,t):!1!==o.existsSync(e)?(u[e]=new l(e),u[e].on(c,t)):i.logger.error("<watcher> File not exists",e)},unwatch:function(e,t){var r=u[e];null!=r?null!=t&&(r.off(c,t),0!==r._listeners.length)||(r.close(),delete u[e]):i.logger.warn("<watcher> No exists",e)}};var a,l=(a=s.class_EventEmitter,r(f,a),f.prototype.changed=function(e,t){this.timeout&&clearTimeout(this.timeout),this.lastEventType=e,this.lastFilename=t,this.timeout=setTimeout(this.reportChange,100)},f.prototype.close=function(){this.fswatcher.close(),this.off(c)},f.prototype.reportChange=function(){this.trigger(c,this.path),"rename"===this.lastEventType&&(this.lastFilename&&this.path.endsWith(this.lastFilename)||o.existsSync(this.path))&&this.reattach()},f.prototype.reattach=function(){this.fswatcher.close(),this.fswatcher=o.watch(this.path,this.changed)},f);function f(e){var t=a.call(this)||this;return t.changed=t.changed.bind(t),t.reportChange=t.reportChange.bind(t),t.path=e,t.fswatcher=o.watch(e,t.changed),t}function p(e){return null!=e&&"object"==typeof e&&e.constructor===Object}p(G)&&p(t.exports)?Object.assign(G,t.exports):G=t.exports}(),function(){var n,e=null!=j?j:{},t={exports:e},r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.GlobRegExp=e.glob_getRelativePath=e.glob_getStrictPath=e.glob_toRegExp=e.glob_parseDirs=e.glob_parsePatterns=e.glob_matchPath=e.glob_getCalculatedPath=void 0;var s=z;function c(e){var t=(e="/"===e[0]?e.substring(1):e).split("/"),r=-1!==e.indexOf("**")?1/0:t.length;t.pop();for(var n=0;n<t.length;n++)-1!==t[n].indexOf("*")&&t.splice(n);return[r,t.length,t.join("/").toLowerCase()]}function u(e){var t="",r=-1,n=e.length;for(e=e.replace(/(\*\*\/){2,}/g,"**/");++r<n;){var o,i=e[r];switch(i){case"?":t+=".";break;case"*":if("*"===e[r+1]){0===r&&/[\\\/]/.test(e[r+2])&&(t+=".+",r+=2),t+=".+",r++;break}t+="[^/]+";break;case"{":if(~(o=e.indexOf("}",r))){t+="("+e.substring(r+1,o).replace(/,/g,"|")+")",r=o;break}t+=i;break;case"[":if(~(o=e.indexOf("]",r))){t=e.substring(r,o),r=o;break}t+=i;break;default:~"\\^$*+?.()|{}[]".indexOf(i)&&(t+="\\"),t+=i}}return new a(t="^"+t+"$","i")}e.glob_getCalculatedPath=function(e,t){var r=t.indexOf("*"),t=-1===(r=t.lastIndexOf("/",r))?null:t.substring(0,r);return r?-1===(r=e.toLowerCase().indexOf(t.toLowerCase()))?(s.logger.warn("[substring not found]",e,t),e):e.substring(r+t.length):e},e.glob_matchPath=function(e,t){return"/"===t[0]&&(t=t.substring(1)),u(e="/"===e[0]?e.substring(1):e).test(t)},e.glob_parsePatterns=function t(e,r){if(null==e)return null;if(null==r&&(r=[]),Array.isArray(e))return e.forEach(function(e){t(e,r)}),r;if(e instanceof RegExp)return r.push(e),r;if("string"!=typeof e)return s.logger.error("<glob> Unsupported pattern",e),r;var n=e,o=c(n="/"===n[0]?n.substring(1):n),i=o[0],e=o[1],o=o[2],n=u(n);return n.depth=i,n.rootCount=e,n.root=o,r.push(n),r},e.glob_parseDirs=c,e.glob_toRegExp=u,e.glob_getStrictPath=function(e){var t=e.indexOf("*");return-1===t?(s.logger.error("glob.js [path is not a glob pattern]",e),null):e.substring(0,e.lastIndexOf("/",t)+1)},e.glob_getRelativePath=function(e){var t=e.indexOf("*");return-1===t?(s.logger.error("glob.js [path is not a glob pattern]",e),null):e.substring(e.lastIndexOf("/",t)+1)};var o,a=(o=RegExp,r(i,o),i);function i(){return null!==o&&o.apply(this,arguments)||this}function l(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.GlobRegExp=a,l(j)&&l(t.exports)?Object.assign(j,t.exports):j=t.exports}(),function(){var e=null!=ee?ee:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.path_ensureTrailingSlash=e.path_resolveAppUri=e.path_resolveUri=e.path_isSubDir=e.path_getDir=e.path_combine=e.path_getUri=e.path_getProtocol=void 0;var r=z,n=require("atma-utils");function o(e){if(!e)return"/";var t=e.lastIndexOf("/");return-1===t?"":e.substring(t+1,-t)}function i(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.path_getProtocol=function(e){var t=e.indexOf(":");return-1===t||"/"!==e[t+1]||"/"!==e[t+2]?null:e.substring(0,t)},e.path_getUri=function(e,t){return"/"===(e=function(e){e=e.replace(/\\/g,"/").replace(/^\.\//,"");var t=/\/{2,}/g,r=!1;for(;;){var n=t.exec(e);if(null==n)break;0!==n.index&&(":"!==e[n.index-1]||!1!==r?e=e.substring(0,n.index)+"/"+e.substring(n.index+n[0].length):r=!0)}return e}(e="string"!=typeof e?e.toString():e))[0]&&(e=e.substring(1)),!1===(e=new n.class_Uri(e)).isRelative()?e:(t?new n.class_Uri(t):r.io.env?r.io.env.currentDir:new n.class_Uri("file://"+process.cwd()+"/")).combine(e)},e.path_combine=function(e,t){return e?t?("/"===t[0]&&(t=t.substring(1)),"/"===e[e.length-1]?e+t:e+"/"+t):e:t},e.path_getDir=o,e.path_isSubDir=function(e,t){return e=o(e),0===o(t).toLowerCase().indexOf(e.toLowerCase())},e.path_resolveUri=function(e,t,r){return"/"===e[0]&&(t=r,e=e.substring(1)),(e=new n.class_Uri(e)).isRelative()?new n.class_Uri(t).combine(e):e},e.path_resolveAppUri=function(e,t){if("/"===e[0])return e;if("./"===e.substring(0,2)&&(e=e.substring(2)),!t||"file"===e.substring(0,4))return"/";var r=t.lastIndexOf("/");return(-1===r?"/":t.substring(r+1,-r))+e},e.path_ensureTrailingSlash=function(e){return"/"===e[e.length-1]?e:e+"/"},i(ee)&&i(t.exports)?Object.assign(ee,t.exports):ee=t.exports}(),function(){var r=null!=X?X:{},e={exports:r};Object.defineProperty(r,"__esModule",{value:!0}),r.CustomTransport=r.Repository=void 0,r.Repository={};var t=(n.register=function(e,t){r.Repository[e]=t},n.get=function(e){return r.Repository[e]},n.all=function(){return r.Repository},n.set=function(e){for(var t in e)r.Repository[t]=e[t]},n);function n(){}function o(e){return null!=e&&"object"==typeof e&&e.constructor===Object}r.CustomTransport=t,o(X)&&o(e.exports)?Object.assign(X,e.exports):X=e.exports}(),P={exports:F=null!=_?_:{}},Object.defineProperty(F,"__esModule",{value:!0}),F.obj_extend=void 0,F.obj_extend=function(e,t){if(null==e&&(e={}),null==t)return e;for(var r in t)e[r]=t[r];return e},e(_)&&e(P.exports)?Object.assign(_,P.exports):_=P.exports,function(){var e=null!=V?V:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.fs_getStat=e.fs_isDirectory=void 0;var r=require("fs");function n(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.fs_isDirectory=function(e){try{return r.statSync(e).isDirectory()}catch(e){return!1}},e.fs_getStat=function(e){try{return r.statSync(e)}catch(e){return null}},n(V)&&n(t.exports)?Object.assign(V,t.exports):V=t.exports}(),function(){var e=null!=p?p:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.DirectoryFsTransport=void 0;var m=z,w=require("fs"),c=_,o=V,A=ee;function r(e){return o.fs_isDirectory(e)}function s(e,r){w.stat(e,function(e,t){"ENOENT"!==(null==e?void 0:e.code)?r(e,t&&t.isDirectory()):r(null,!1)})}function u(e){return""===e||"/"===e||/^[A-Z]:\/?$/i.test(e)}function b(e,t){for(var r=-1,n=t.length;++r<n;)if(t[r].test(e))return!0;return!1}function a(e){if(null==e)return 1/0;for(var t=0,r=e.length,n=-1;++n<r;)t<e[n].depth&&(t=e[n].depth);return t||1/0}function l(t,r){var n;return function(e){n=n||e,--t<1&&r(n)}}function j(e){try{return w.lstatSync(e)}catch(e){return null}}function n(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.DirectoryFsTransport={ensure:function e(t){"/"===t[t.length-1]&&(t=t.substring(0,t.length-1));if(!1===w.existsSync(t)){var r,n=t.substring(0,t.lastIndexOf("/"));if(r=!1===u(n)?e(n):r)return r.toString();try{w.mkdirSync(t)}catch(e){return e.toString()}}if(!o.fs_isDirectory(t))return"Target exists, but is not a directory:"+t},ensureAsync:function r(n,o){n=n.replace(/\/*$/,"");s(n,function(e,t){if(t)return o();t=n.substring(0,n.lastIndexOf("/"));!1===u(t)?r(t,i):i()});function i(){w.mkdir(n,function(e){e&&("EEXIST"!==e.code&&47!==e.errno&&-4707!==e.errno||(e=null)),o(e)})}},ceateSymlink:function(e,t){!function(e,t){try{w.symlinkSync(e,t,"junction")}catch(e){m.logger.error("symlink: bold<%s>",e)}}(e,t)},exists:r,existsAsync:function(e,t){s(e,t)},readFiles:function(e,t,r,n){return t=t,r=r,function e(t,r,n){var o,i=[];try{o=w.readdirSync(t)}catch(e){return console.error("<dir walk>",e),i}null==r&&(r="");null==n&&(n={depth:0,maxdepth:1/0,directories:!1,symlinks:!1});var s=n.depth,c=n.patterns,u=n.excludes;n.depth++;for(var a,l=0,f=o.length;l<f;l++){a=o[l];var p=j(A.path_combine(t,a)),h=A.path_combine(r,a),d=!0;if(null!=p)if(p.isDirectory()){if(!(p.isSymbolicLink()||(n.directories&&i.push(A.path_combine(t,a)+"/"),n.depth>=n.maxdepth))){var y=A.path_combine(r,a);if(c){for(var g=!1,v=0,b=c.length;v<b;v++){var _=c[v].rootCount-s,x=c[v].root;if(!_||_<s){g=!0;break}if(0===x.indexOf(y)){g=!0;break}m.logger(90).warn("<glob> not matched %s | %s",y,x)}if(!1===g)continue}m.logger(90).warn("<glob> match sub-",y),i=i.concat(e(A.path_combine(t,a),y,n))}}else{if(c){d=!1;for(v=0,b=c.length;v<b;v++)if(c[v].test(h)){d=!0;break}}if(d&&u)for(v=0,b=u.length;v<b;v++)if(u[v].test(h)){d=!1;break}d&&i.push(h)}}n.depth=s;return i}(e,"",c.obj_extend(n,{depth:0,maxdepth:a(t),patterns:t,excludes:r}))},readFilesAsync:function(e,t,r,n,o){!function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.pop();for(;null==n&&0<t.length;)n=t.pop();var o=t.shift(),i=t.shift(),s=t.shift();!function u(a,l,f,p,h,i){var d=f,y=p.maxdepth,g=p.patterns,r=p.excludes;f++;w.readdir(a,function(e,t){if(e)return i(e,h);if(0===t.length)return i(null,h);for(var r=-1,n=t.length,o=s(n);++r<n;)c(t[r],o)});function s(t){var r;return function(e){r=r||e,0==--t&&i(r,h)}}function c(r,n){var e=A.path_combine(a,r);w.lstat(e,function(e,t){return e?n():t.isDirectory()?o(r,t,n):(v(r,h),void n())})}function o(e,t,r){if(t.isSymbolicLink())return r();if(p.directories&&h.push(A.path_combine(l,e)+"/"),y<=f)return r();var n=A.path_combine(l,e);if(g){for(var o=-1,i=g.length;++o<i;){var s=g[o].rootCount-d,c=g[o].root;if(!s||s<d)break;if(0===c.indexOf(n))break}if(i<=o)return r()}u(A.path_combine(a,e),n,f,p,h,r)}function v(e,t){e=A.path_combine(l,e);g&&!1===b(e,g)||r&&!0===b(e,r)||t.push(e)}}(e,"",0,c.obj_extend(s,{maxdepth:a(o),patterns:o,excludes:i}),[],n)}(e,t,r,n,o)},remove:function(e){if(!1===r(e))return!0;try{return function e(t){var r,n=w.readdirSync(t),o=n.length,i=-1;for(;++i<o;)"."!==(r=n[i])&&".."!==r&&(r=t+"/"+r,w.lstatSync(r).isDirectory()?e(r):w.unlinkSync(r));w.rmdirSync(t)}(e),!0}catch(e){return!1}},removeAsync:function(e,t){(function o(s,c){w.readdir(s,function(e,t){if(e)c(e);else{var r=t.length,n=-1;if(0!==r)for(var o,i=l(r,a);++n<r;)"."!==(o=t[n])&&".."!==o?u(A.path_combine(s,o),i):i();else a()}});function u(r,n){w.lstat(r,function(e,t){e?n(e):t.isDirectory()?o(r,n):w.unlink(r,n)})}function a(){w.rmdir(s,c)}})(e,t)},rename:function(e,t){w.renameSync(e,t)},renameAsync:function(e,t,r){w.rename(e,t,r)}},n(p)&&n(t.exports)?Object.assign(p,t.exports):p=t.exports}(),function(){var e=null!=Y?Y:{},t={exports:e},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,c=i.length;s<c;s++,o++)n[o]=i[s];return n};Object.defineProperty(e,"__esModule",{value:!0}),e.log_info=e.log_error=void 0;var n=z;e.log_error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(void 0,r([o.red],e))},e.log_info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(void 0,r([o.cyan],e))};var o="[atma-io]";function i(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];t.unshift(e),n.logger.log.apply(n.logger,t)}function s(e){return null!=e&&"object"==typeof e&&e.constructor===Object}s(Y)&&s(t.exports)?Object.assign(Y,t.exports):Y=t.exports}(),function(){var s=null!=y?y:{},e={exports:s};Object.defineProperty(s,"__esModule",{value:!0}),s.Errno=s.FileFsTransport=void 0;var c=require("fs"),u=p,a=Y,l=z,f=ee;s.FileFsTransport={save:function(e,t,r){if(u.DirectoryFsTransport.ensure(f.path_getDir(e)))a.log_error("file_save",e);else try{c.writeFileSync(e,t,r)}catch(e){a.log_error("file_save",e.toString())}},saveAsync:function(t,r,n,o){u.DirectoryFsTransport.ensureAsync(f.path_getDir(t),function(e){return e?o(e):void c.writeFile(t,r,n||i,o)})},copy:function(e,t){if(!1!==c.existsSync(e))if(u.DirectoryFsTransport.ensure(f.path_getDir(t)))a.log_error("file_copy Target error",t);else try{!function(e,t){var r=new Buffer(65536),n=1,o=c.openSync(e,"r"),i=c.openSync(t,"w"),s=0;for(;0<n;)n=c.readSync(o,r,0,65536,s),c.writeSync(i,r,0,n),s+=n;c.closeSync(o),c.closeSync(i)}(e,t)}catch(e){a.log_error("file_copy",e.toString())}else a.log_error("file_copy 404",e)},copyAsync:function(r,n,o){function i(e){var t;e?o(e):(t=c.createReadStream(r).on("error",function(e){l.logger.log("readstream error",r,e),o&&o(e),o=null}),e=c.createWriteStream(n).on("error",function(e){l.logger.log("writestream error",n,e),o&&o(e),o=null}).on("close",function(){o&&o(null),o=null}),t.pipe(e))}s.FileFsTransport.existsAsync(r,function(e,t){if(!0!==t)return o({code:404,message:r+" not exists."});u.DirectoryFsTransport.ensureAsync(f.path_getDir(n),i)})},exists:function(e){return c.existsSync(e)&&c.statSync(e).isFile()},existsAsync:function(e,r){c.stat(e,function(e,t){n.isNotFound(e)?r(null,!1):(t=null!==(t=null==t?void 0:t.isFile())&&void 0!==t&&t,r(e,t))})},read:function(e,t){try{return c.readFileSync(e,t)}catch(e){a.log_error("file_read",e.toString())}return""},readAsync:function(e,t,r){c.readFile(e,{encoding:t},r)},readRange:function(e,t,r,n){try{var o=c.openSync(e,"r"),i=Buffer.alloc(r);return c.readSync(o,i,0,r,t),"buffer"!==n?i.toString(null!=n?n:"utf8"):i}catch(e){a.log_error("file_readRange",e.toString())}return""},readRangeAsync:function(e,t,o,i,s){c.open(e,"r",438,function(r,e){var n;r?s(r,null):(n=Buffer.alloc(o),c.read(e,n,0,o,t,function(e,t){r?s(r,null):s(null,"buffer"===i?n:n.toString(null!=i?i:"utf8"))}))})},remove:function(e){if(!1===s.FileFsTransport.exists(e))return!0;try{c.unlinkSync(e)}catch(e){return a.log_error("file_remove",e.toString()),!1}return!0},removeAsync:function(e,t){c.unlink(e,function(e){n.isNotFound(e)&&(e=null),t(e)})},rename:function(e,t){if(!1===s.FileFsTransport.exists(e))return a.log_error("file_rename 404",e),!1;try{c.renameSync(e,o(e)+t)}catch(e){return a.log_error("file_rename",e.toString()),!1}return!0},renameAsync:function(e,t,r){c.rename(e,o(e)+t,function(e){r(e,null==e)})},appendAsync:function(e,r,n){r?c.open(e,"a",function(e,t){e?n(e):c.write(t,r,function(e){e?n(e):c.close(t,function(){return n()})})}):null!=n&&n()},append:function(e,t){if(t)try{var r=c.openSync(e,"a");return c.writeSync(r,t),c.closeSync(r),!0}catch(e){return!1}}};var n,t,i={encoding:"utf8"};function o(e){return e.substring(0,e.lastIndexOf("/")+1)}function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}(t=n=s.Errno||(s.Errno={})).isNotFound=function(e){return null!=e&&(34===e.errno||-4058===e.errno||"ENOENT"===e.code)},t.isExists=function(e){return null!=e&&(-4075===e.errno||"EEXIST"===e.code)},r(y)&&r(e.exports)?Object.assign(y,e.exports):y=e.exports}(),function(){var e=null!=h?h:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.FsTransport=void 0;var r=y,n=p;function o(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.FsTransport={File:r.FileFsTransport,Directory:n.DirectoryFsTransport},o(h)&&o(t.exports)?Object.assign(h,t.exports):h=t.exports}(),function(){var e=null!=m?m:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.dir_renameAsync=e.dir_rename=e.dir_removeAsync=e.dir_remove=e.dir_symlink=e.dir_filesAsync=e.dir_files=e.dir_existsAsync=e.dir_exists=e.dir_ensureAsync=e.dir_ensure=void 0;var r=ee,n=X,o=h;function i(e){var t=r.path_getProtocol(e);if(null==t||"file"===t)return o.FsTransport.Directory;e=n.CustomTransport.get(t);if(null==e)throw new Error("Transport '"+t+"' is not supported or not installed");return e.Directory}function s(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.dir_ensure=function(e){return i(e).ensure(e)},e.dir_ensureAsync=function(e,t){i(e).ensureAsync(e,t)},e.dir_exists=function(e){return i(e).exists(e)},e.dir_existsAsync=function(e,t){i(e).existsAsync(e,t)},e.dir_files=function(e,t,r,n){return i(e).readFiles(e,t,r,n)},e.dir_filesAsync=function(e,t,r,n,o){return i(e).readFilesAsync(e,t,r,n,o)},e.dir_symlink=function(e,t){i(e).ceateSymlink(e,t)},e.dir_remove=function(e){return i(e).remove(e)},e.dir_removeAsync=function(e,t){return i(e).removeAsync(e,t)},e.dir_rename=function(e,t){return i(e).rename(e,t)},e.dir_renameAsync=function(e,t,r){return i(e).renameAsync(e,t,r)},s(m)&&s(t.exports)?Object.assign(m,t.exports):m=t.exports}(),T={exports:S=null!=v?v:{}},Object.defineProperty(S,"__esModule",{value:!0}),S.is_RegExp=S.is_Promise=void 0,S.is_Promise=function(e){return"function"==typeof(null==e?void 0:e.then)},S.is_RegExp=function(e){return e instanceof RegExp},t(v)&&t(T.exports)?Object.assign(v,T.exports):v=T.exports,function(){var e=null!=K?K:{},t={exports:e},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,c=i.length;s<c;s++,o++)n[o]=i[s];return n};function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}Object.defineProperty(e,"__esModule",{value:!0}),e.cb_toPromiseCtx=e.cb_toPromise=void 0,e.cb_toPromise=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return new Promise(function(r,n){e.apply(void 0,i(t,[function(e,t){e?n(e):r(t)}]))})},e.cb_toPromiseCtx=function(e,t){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];return new Promise(function(r,n){t.call.apply(t,i([e],o,[function(e,t){e?n(e):r(t)}]))})},r(K)&&r(t.exports)?Object.assign(K,t.exports):K=t.exports}(),function(){var e=null!=g?g:{},t={exports:e},r=this&&this.__awaiter||function(e,s,c,u){return new(c=c||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((u=u.apply(e,s||[])).next())})},n=this&&this.__generator||function(r,n){var o,i,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.LockFile=void 0;var o,i,s=require("atma-utils"),c=require("fs"),u=require("os"),a=y,l=(f.prototype.acquire=function(){var e=new s.class_Dfr;return this.queue.push(e),this.current||this.next(),e},f.prototype.release=function(){return this.onRelease()},f.prototype.next=function(){this.current=null,this.upgradingDfr=null,this.releasingDfr=null,0!==this.queue.length&&(this.current=this.queue.shift(),this.acquireInner())},f.prototype.acquireInner=function(){var r=this;this.tryAcquire(function(e,t){e?r.onError(e):t?r.onAcquire():r.doCheckStale()})},f.prototype.onAcquire=function(){var e=this;this.acquiredAt=Date.now(),this.upgradeLockTimeout=setTimeout(function(){return e.upgradeLock()},5e3),this.current.resolve()},f.prototype.onRelease=function(){return r(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return this.releasingDfr=new s.class_Dfr,[4,this.upgradingDfr];case 1:return e.sent(),[4,this.releaseLock()];case 2:return e.sent(),this.releasingDfr.resolve(),this.next(),[2]}})})},f.prototype.onError=function(e){var t=this;if(this.current.reject(e),this.fd)return c.closeSync(this.fd),void c.unlink(this.pathLock,function(){t.next()});this.next()},f.prototype.upgradeLock=function(){var t=this;this.upgradingDfr=new s.class_Dfr,c.write(this.fd,""+process.pid,function(e){t.upgradingDfr.resolve()})},f.prototype.releaseLock=function(){null!=this.upgradeLockTimeout&&clearTimeout(this.upgradeLockTimeout);var e=new s.class_Dfr;return null!=this.fd?(c.close(this.fd,function(){}),void c.unlink(this.pathLock,function(){e.resolve()})):(e.resolve(),e)},f.prototype.tryAcquire=function(r){var n=this;c.open(this.pathLock,"wx",function(e,t){n.fd=t,null!=e?a.Errno.isNotFound(e)?(t=n.pathLock.replace(/[\\/][^\\/]+$/,""),!1===c.existsSync(t)&&(c.mkdirSync(t,{recursive:!0}),n.tryAcquire(r))):!1!==a.Errno.isExists(e)?r(null,!1):r(e):r(null,!0)})},f.prototype.doCheckStale=function(){var r=this;c.stat(this.pathLock,function(e,t){return e?a.Errno.isNotFound(t)?void r.acquireInner():void r.onError(e):(r.lastCheck=Date.now(),r.lastMod=o.createdAt(t),void(5e3<r.lastCheck-r.lastMod?r.doCheckPid():r.pollStart()))})},f.prototype.pollStart=function(){this.pollStartedAt=Date.now(),this.pollAcquire()},f.prototype.pollAcquire=function(){var r=this;this.pollTimeout=setTimeout(function(){r.tryAcquire(function(e,t){e?r.onError(e):t?r.onAcquire():5e3<Date.now()-r.pollStartedAt?r.doCheckPid():r.pollAcquire()})},50)},f.prototype.forceAcquire=function(){var e=this;this.fd&&c.closeSync(this.fd),c.unlink(this.pathLock,function(){e.acquireInner()})},f.prototype.doCheckPid=function(){var r=this;0<this.lockedByPid?this.checkProcess(this.lockedByPid)?this.pollStart():this.forceAcquire():c.readFile(this.pathLock,{encoding:"utf8"},function(e,t){if(e)return a.Errno.isNotFound(e)?void r.acquireInner():void r.onError(e);t=Number(t);0===t||isNaN(t)?r.forceAcquire():(r.lockedByPid=t,r.doCheckPid())})},f.prototype.checkProcess=function(e){if(0===e||isNaN(e))return!1;try{return process.kill(e,0),!0}catch(e){return!1}},f);function f(e){this.path=e,this.queue=[],this.pathLock=this.path+".lock"}function p(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.LockFile=l,l=o=o||{},i="win32"===u.platform()?"mtime":"ctime",l.createdAt=function(e){return e[i].getTime()},p(g)&&p(t.exports)?Object.assign(g,t.exports):g=t.exports}(),function(){var e=null!=f?f:{},t={exports:e},s=this&&this.__awaiter||function(e,s,c,u){return new(c=c||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((u=u.apply(e,s||[])).next())})},c=this&&this.__generator||function(r,n){var o,i,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.SafeFile=void 0;var r=require("atma-utils"),u=K,a=y,n=g,o=(i.prototype.write=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},i.prototype.writeAsync=function(e){if(null==e)throw new Error("Empty data");this.content=e;var t=new r.class_Dfr;return this.listeners.push({version:++this.version,promise:t}),!0===this.busy?this.pending=e:(this.busy=!0,this.lockInProc.defer(),this.writeInner(e)),t},i.prototype.readAsync=function(t){var r,n;return void 0===t&&(t="utf8"),s(this,void 0,Promise,function(){return c(this,function(e){switch(e.label){case 0:return this.busy?[2,null!==(r=this.pending)&&void 0!==r?r:this.content]:[4,null===(n=this.lockOutProc)||void 0===n?void 0:n.acquire()];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,5,6]),[4,this.readInner(t)];case 3:return[2,e.sent()];case 4:throw e.sent();case 5:return null!==(n=this.lockOutProc)&&void 0!==n&&n.release(),[7];case 6:return[2]}})})},i.prototype.readInner=function(r){return s(this,void 0,Promise,function(){var t;return c(this,function(e){switch(e.label){case 0:return[4,u.cb_toPromise(a.FileFsTransport.existsAsync,this.pathBak)];case 1:return e.sent()?[4,u.cb_toPromise(a.FileFsTransport.readAsync,this.pathBak,r)]:[3,6];case 2:return(t=e.sent())?[4,u.cb_toPromise(a.FileFsTransport.renameAsync,this.pathBak,this.pathFilename)]:[3,4];case 3:return e.sent(),[2,t];case 4:return[4,u.cb_toPromise(a.FileFsTransport.removeAsync,this.pathBak)];case 5:e.sent(),e.label=6;case 6:return e.trys.push([6,8,,9]),[4,u.cb_toPromise(a.FileFsTransport.readAsync,this.path,r)];case 7:return[2,e.sent()];case 8:return e.sent(),[2,null];case 9:return[2]}})})},i.prototype.writeInner=function(n){var o,i;return s(this,void 0,void 0,function(){var t,r;return c(this,function(e){switch(e.label){case 0:t=this.version,e.label=1;case 1:return e.trys.push([1,5,6,7]),[4,null===(o=this.lockOutProc)||void 0===o?void 0:o.acquire()];case 2:return e.sent(),[4,u.cb_toPromise(a.FileFsTransport.saveAsync,this.pathBak,n,null)];case 3:return e.sent(),[4,u.cb_toPromise(a.FileFsTransport.renameAsync,this.pathBak,this.pathFilename)];case 4:return e.sent(),this.callWriteListeners(t,null),[3,7];case 5:return r=e.sent(),this.errored=r,this.callWriteListeners(t,r),[3,7];case 6:return null==this.pending?(this.busy=!1,null!==(i=this.lockOutProc)&&void 0!==i&&i.release(),this.lockInProc.resolve(),[2]):(r=this.pending,(this.pending=null)!==(i=this.lockOutProc)&&void 0!==i&&i.release(),this.writeInner(r),[7]);case 7:return[2]}})})},i.prototype.callWriteListeners=function(e,t){void 0===t&&(t=null);for(var r=0;r<this.listeners.length;r++){var n=this.listeners[r];if(n.version<=e)try{null!=t?n.promise.reject(t):n.promise.resolve()}finally{this.listeners.splice(r,1),r--}}},i);function i(e,t){this.path=e,this.opts=t,this.errored=null,this.listeners=[],this.version=0,this.busy=!1,this.pathBak=this.path+".bak",this.pathFilename=this.path.substring(this.path.lastIndexOf("/")+1),this.lockInProc=new r.class_Dfr,this.lockOutProc=null!==(t=this.opts)&&void 0!==t&&t.threadSafe?new n.LockFile(this.path):null,this.lockInProc.resolve()}function l(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.SafeFile=o,l(f)&&l(t.exports)?Object.assign(f,t.exports):f=t.exports}(),function(){var e=null!=d?d:{},t={exports:e},r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FsTransportSafe=void 0;var i,n=h,s=f;function o(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e=e.FsTransportSafe||(e.FsTransportSafe={}),i=Object.create(null),e.File=r(r({},n.FsTransport.File),{save:function(e,t,r){throw new Error("Sync methods are not supported in FsTransportSafe")},saveAsync:function(e,t,r,n){var o;(null!==(o=i[e])&&void 0!==o?o:i[e]=new s.SafeFile(e)).writeAsync(t).then(function(e){return n(null,e)},function(e){return n(e)})},read:function(e,t){throw new Error("Sync methods are not supported in FsTransportSafe")},readAsync:function(e,t,r){var n;(null!==(n=i[e])&&void 0!==n?n:i[e]=new s.SafeFile(e)).readAsync(t).then(function(e){return r(null,e)},function(e){return r(e)})}}),e.Directory=n.FsTransport.Directory,o(d)&&o(t.exports)?Object.assign(d,t.exports):d=t.exports}(),function(){var e=null!=Z?Z:{},t={exports:e},c=this&&this.__awaiter||function(e,s,c,u){return new(c=c||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((u=u.apply(e,s||[])).next())})},u=this&&this.__generator||function(r,n){var o,i,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.file_appendAsync=e.file_append=e.file_renameAsync=e.file_rename=e.file_removeAsync=e.file_remove=e.file_readRangeAsync=e.file_readRange=e.file_readAsync=e.file_read=e.file_existsAsync=e.file_exists=e.file_copyAsync=e.file_copy=e.file_saveAsync=e.file_save=void 0;var n=X,o=h,i=ee,a=v,s=d,l=K;function f(e,t,r){var n=p(e,r);return 2===n.version?n.saveAsync(e,t,r):l.cb_toPromise(n.saveAsync,e,t,r)}function p(e,t){var r=i.path_getProtocol(e);if(null==r||"file"===r)return(null!=t&&t.threadSafe||null!=t&&t.processSafe?s.FsTransportSafe:o.FsTransport).File;t=n.CustomTransport.get(r);if(null==t)throw new Error("Transport '"+r+"' is not supported or not installed for path '"+e+"'");return t.File}function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.file_save=function(e,t,r,n){var o=p(e);null!=n&&(t=n(t)),o.save(e,t,r)},e.file_saveAsync=function(n,o,i,s){return c(this,void 0,void 0,function(){var t,r;return u(this,function(e){switch(e.label){case 0:return null==s?[2,f(n,o,i)]:(t=s(o),a.is_Promise(t)?[4,t]:[3,2]);case 1:return r=e.sent(),[2,f(n,r,i)];case 2:return[2,f(n,t,i)]}})})},e.file_copy=function(e,t){var r,n=p(e),o=p(t);n!==o?(r=n.read(e),o.save(t,r)):n.copy(e,t)},e.file_copyAsync=function(e,r,n){var t=p(e),o=p(r);t!==o?t.readAsync(e,null,function(e,t){e?n(e):o.saveAsync(r,t,null,n)}):t.copyAsync(e,r,n)},e.file_exists=function(e){return p(e).exists(e)},e.file_existsAsync=function(e){var t=p(e);return 2===t.version?t.existsAsync(e):l.cb_toPromise(t.existsAsync,e)},e.file_read=function(e,t,r){return e=p(e).read(e,null==r?t:null),null==r?e:(e=r(e),null==t?e:e.toString(t))},e.file_readAsync=function(n,o,i,s){return c(this,void 0,Promise,function(){var t,r;return u(this,function(e){switch(e.label){case 0:return 2!==(t=p(n)).version?[3,2]:[4,t.readAsync(n,null==s?o:null,i)];case 1:return r=e.sent(),[3,4];case 2:return[4,l.cb_toPromise(t.readAsync,n,null==s?o:null)];case 3:r=e.sent(),e.label=4;case 4:return null==s?[3,6]:[4,function(r,n,o){return c(this,void 0,Promise,function(){var t;return u(this,function(e){switch(e.label){case 0:return t=r(n),a.is_Promise(t)?[4,t]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return[2,t=null!=o?t.toString(o):t]}})})}(s,r,o)];case 5:r=e.sent(),e.label=6;case 6:return[2,r]}})})},e.file_readRange=function(e,t,r,n){return p(e).readRange(e,t,r,n)},e.file_readRangeAsync=function(e,t,r,n,o){p(e).readRangeAsync(e,t,r,n,o)},e.file_remove=function(e){return p(e).remove(e)},e.file_removeAsync=function(e,t){p(e).removeAsync(e,t)},e.file_rename=function(e,t){return p(e).rename(e,t)},e.file_renameAsync=function(e,t,r){p(e).renameAsync(e,t,r)},e.file_append=function(e,t){return p(e).append(e,t)},e.file_appendAsync=function(e,t,r){p(e).appendAsync(e,t,r)},r(Z)&&r(t.exports)?Object.assign(Z,t.exports):Z=t.exports}(),function(){var e=null!=B?B:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.FileFactory=void 0;var i=require("atma-utils"),r=(n.prototype.registerHandler=function(e,t){!function(e){var t,r="function"==typeof e?e.prototype:e;for(t in r){var n,o=r[t];"function"==typeof o&&(-1!==t.indexOf("Async")||null==r[n=t+"Async"]&&(r[n]=function(o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=new i.class_Dfr;try{var n=o.apply(this,e);return r.resolve(n)}catch(e){return r.reject(e)}}}(o)))}}(t),this.handlers.push({handler:t,regexp:e})},n.prototype.unregisterHandler=function(e,t){for(var r,n=e.toString(),o=this.handlers.length,i=-1;++i<o;)if((r=this.handlers[i]).regexp.toString()===n)if(void 0!==t){if(t===r)return void this.handlers.splice(i,1)}else this.handlers.splice(i,1),i--,o--},n.prototype.resolveHandler=function(e){e=e.toString(),e=function(e,t){var r,n=e.length,o=-1;for(;++o<n;)if(function t(e,r){if(Array.isArray(e))return e.some(function(e){return t(e,r)});e.lastIndex=0;return e.test(r)}((r=e[o]).regexp,t))return r;return null}(this.handlers,e);return e?e.handler:null},n);function n(){this.handlers=[]}function o(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.FileFactory=r,o(B)&&o(t.exports)?Object.assign(B,t.exports):B=t.exports}(),E={exports:D=null!=n?n:{}},Object.defineProperty(D,"__esModule",{value:!0}),D.arr_isArray=D.arr_find=D.arr_each=D.arr_any=D.arr_eachOrSingle=void 0,D.arr_eachOrSingle=function(e,t){return!1===s(e)?(t(e),e):r(e,t)},D.arr_any=function(e,t){if(!1===s(e))return!1;for(var r=e.length,n=-1;++n<r;)if(t(e[n],n))return!0;return!1},D.arr_each=r,D.arr_find=function(e,t){if(null==e)return e;for(var r=e.length,n=-1;++n<r;)if(t(e[n],n))return e[n];return null},D.arr_isArray=s,c(n)&&c(E.exports)?Object.assign(n,E.exports):n=E.exports,M={exports:R=null!=b?b:{}},Object.defineProperty(R,"__esModule",{value:!0}),R.rgx_prepairString=void 0,R.rgx_prepairString=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},a(b)&&a(M.exports)?Object.assign(b,M.exports):b=M.exports,function(){var e=null!=$?$:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.getFileHookRegexp=e.FileHookRegistration=void 0;var s,c=N,u=n,a=z,o=b;function l(e,t,r,n,o,i){null!=t&&(null==i||null==n||"string"==typeof t||(n=i[n])&&t.setOptions&&t.setOptions(n),"string"!=typeof t&&t.setIo&&t.setIo(a.io),r=p(r),e.register(r,o,t))}function f(e,t){var r=c.File.middleware[e];if(null==r)try{var n=require(e);n&&n.register&&n.register(a.io),null==(r=c.File.middleware[e])&&(r=n)}catch(e){}return null==r?(a.logger.error("Middleware is not installed",e),null):"object"==typeof r&&(null==r.name&&(r.name=e),null!=t&&null==r[t]&&null==r[t+"Async"])?(a.logger.error("Middleware not defined for action",t,e),null):r}function p(e){if("/"===e[0]){var t=(n=e.substring(1)).lastIndexOf("/"),r=n.substring(t+1),n=n.substring(0,t);return new RegExp(n,r)}e=o.rgx_prepairString(e);return new RegExp("\\."+e+"($|\\?|#)")}function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.FileHookRegistration={registerMiddlewares:function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=null);var n,o=c.File.getHookHandler();for(n in e){var i=e[n];!1!==u.arr_isArray(i)?(t&&function(e,t){t=p(t);e.unregisterByRegexp(t)}(o,n),u.arr_each(i,s.registerHookDelegate(o,n,r))):a.logger.warn("Middleware list for %s is not an array",n)}},ensureMiddleware:f},(s||(s={})).registerHookDelegate=function(t,r,n){return function(e){!function(e,t,r,n){if("string"!=typeof r){if(!Array.isArray(r))throw Error("Invalid handler Definition in registerHook");var o=r[0],i=r[1];l(e,o,t,null,i,n)}else!function(e,t,r,n){var o=/^(.+?)(:(read|write))?$/.exec(r),i=o[1],r=o[3],o=f(i,r);l(e,o,t,i,r,n)}(e,t,r,n)}(t,r,e,n)}},e.getFileHookRegexp=p,r($)&&r(t.exports)?Object.assign($,t.exports):$=t.exports}(),function(){var e=null!=W?W:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.FileHooks=e.HookRunner=void 0;var n=N,i=$,s=v,c=(r.prototype.run=function(e,t,r){!1!==this.canHandle(t.uri.toString(),e)&&("function"==typeof this.handler?this.handler(t,r):this.handler[e]&&this.handler[e](t,r))},r.prototype.runAsync=function(e,t,r,n){if(e===this.method)if(!1!==this.regexp.test(t.uri.toString())){var o=this.handler;if("function"==typeof o)o(t,r),n();else if(o[e+"Async"])o[e+"Async"](t,r,n);else{if(o[e])try{o[e](t,r)}catch(e){return void n(e)}n()}}else n();else n()},r.prototype.canHandle=function(e,t){return(null==t||t===this.method)&&this.regexp.test(e)},r);function r(e,t,r,n){this.regexp=e,this.method=t,this.handler=r,this.zIndex=n}e.HookRunner=c;var o=(u.prototype.register=function(e,t,r,n){var o;if(s.is_RegExp(e)?o=e:"string"==typeof e?o=i.getFileHookRegexp(e):(o=e.regexp,t=e.method,r=e.handler,n=e.zIndex),"string"==typeof r){e=i.FileHookRegistration.ensureMiddleware(r,t);if(null==e)return this;r=e}return!1===this.contains(t,r,o)&&this.hooks.push(new c(o,t,r,n||0)),this},u.prototype.contains=function(e,t,r){for(var n,o=null==r?void 0:r.toString(),i=this.hooks.length,s=-1;++s<i;){var c=this.hooks[s];if(c.method===e&&(null==o||o===(null===(n=c.regexp)||void 0===n?void 0:n.toString()))){if(c.handler.name&&c.handler.name===t.name)return c.handler=t,!0;if(c.handler===t)return!0}}return!1},u.prototype.unregister=function(t,r){"string"==typeof r&&(r=n.File.middleware[r]),this.hooks=this.hooks.filter(function(e){return!(e.method===t&&e.handler===r)})},u.prototype.unregisterByRegexp=function(e){for(var t=e.toString(),r=this.hooks.length,n=-1;++n<r;)this.hooks[n].regexp.toString()===t&&(this.hooks.splice(n,1),n--,r--)},u.prototype.trigger=function(t,r,n){this.getHooksForPath(r.uri.toString(),t).forEach(function(e){e.run(t,r,n)})},u.prototype.triggerAsync=function(e,t,r,n){var o=t.uri.toString(),o=this.getHooksForPath(o,e);new a(o).process(e,t,r,n)},u.prototype.clear=function(){return this.hooks=[],this},u.prototype.getHooksForPath=function(t,r){return this.hooks.filter(function(e){return e.canHandle(t,r)}).sort(function(e,t){return e.zIndex===t.zIndex?0:e.zIndex<t.zIndex?1:-1})},u);function u(){this.hooks=[]}e.FileHooks=o;var a=(l.prototype.process=function(e,t,r,n){this.index=-1,this.cb=n,this.method=e,this.file=t,this.config=r,this.next()},l.prototype.next=function(e){if(e)this.cb(e);else if(++this.index>=this.arr.length)this.cb();else{e=this.arr[this.index];if("function"!=typeof e.handler){var t=e.handler.name;if(t)for(var r=this.index-1;-1<r;r--)if(t===this.arr[r].handler.name)return void this.next()}e.runAsync(this.method,this.file,this.config,this.next)}},l);function l(e){this.arr=e,this.index=-1,this.cb=null,this.method=null,this.file=null,this.config=null,this.next=this.next.bind(this)}function f(e){return null!=e&&"object"==typeof e&&e.constructor===Object}f(W)&&f(t.exports)?Object.assign(W,t.exports):W=t.exports}(),function(){var e=null!=J?J:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.JsonMiddleware=void 0;var n=z,o=U;function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.JsonMiddleware={read:function(t){if("string"==typeof t.content)try{t.content=JSON.parse(t.content)}catch(e){n.logger.error("<json:parser> "+t.uri.toString()+" "+e)}},write:function(t,e){if(null!=t.content&&"object"==typeof t.content)try{var r=e&&e.minify?null:2;t.content=JSON.stringify(t.content,null,r).replace(/\n/g,o.Env.newLine)}catch(e){n.logger.error("<json:stringify> "+t.uri.toString()+" "+e)}}},r(J)&&r(t.exports)?Object.assign(J,t.exports):J=t.exports}(),function(){var e=null!=te?te:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.uri_getFile=void 0;var i=ee;function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.uri_getFile=function(e,t){if(null==t)return e.file;var r=i.path_getUri(t),n=e.toLocalFile(),o=r.toLocalFile();if(!1===n.includes(o))throw new Error(t+" is not the base path for "+n);return e.toRelativeString(r)},r(te)&&r(t.exports)?Object.assign(te,t.exports):te=t.exports}(),function(){var e=null!=Q?Q:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.Encrypt=void 0;var n,o="aes-256-ctr";function r(e,t){var r=t.secret;if(n=null!=n?n:require("crypto"),0===e.length)return Buffer.from([]);if("string"!=typeof r||0===r.length)throw new TypeError("Secret must be a non-empty string");t=n.createHash("sha256").update(r),r=n.randomBytes(16),t=n.createCipheriv(o,t.digest(),r),e=t.update(e);return Buffer.concat([r,e,t.final()])}function i(e,t){var r=t.secret;if(n=null!=n?n:require("crypto"),0===e.length)return Buffer.from([]);t=n.createHash("sha256").update(r);if(Buffer.byteLength(e)<17)throw new TypeError('Provided "encrypted" must decrypt to a non-empty string or buffer');r=e.slice(0,16),r=n.createDecipheriv(o,t.digest(),r),e=e.slice(16);return Buffer.concat([r.update(e),r.final()])}function s(e){return null!=e&&"object"==typeof e&&e.constructor===Object}(e=e.Encrypt||(e.Encrypt={})).encrypt=r,e.decrypt=i,e.delegateEncrypt=function(t){return function(e){return r(e,t)}},e.delegateDecrypt=function(t){return function(e){return i(e,t)}},s(Q)&&s(t.exports)?Object.assign(Q,t.exports):Q=t.exports}(),function(){var e=null!=N?N:{},t={exports:e},r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},u=this&&this.__awaiter||function(e,s,c,u){return new(c=c||Promise)(function(r,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function o(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof c?t:new c(function(e){e(t)})).then(n,o)}i((u=u.apply(e,s||[])).next())})},a=this&&this.__generator||function(r,n){var o,i,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],i=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.File=void 0;var s,n,i=require("atma-utils"),c=ee,l=Z,o=z,f=Y,p=V,h=U,d=G,y=B,g=W,v=$,b=X,_=J,x=z,m=te,w=Q,A=K,j={},O=!0,k=process.cwd(),F=(P.prototype.read=function(e){if(null!=this.content)return this.content;var t=E(e),r=D(this.uri),e=M(e,this.opts);return this.content=l.file_read(r,t.encoding,e),H("read",this,t,this.opts),this.content},P.read=function(e,t){return new P(e,t).read(t)},P.prototype.readAsync=function(c){return u(this,void 0,Promise,function(){var t,r,n,o,i,s;return a(this,function(e){switch(e.label){case 0:if(null!=this.content)return[2,this.content];t=D(this.uri),r=E(c),n=R(c,this.opts),o=M(c,this.opts),e.label=1;case 1:return e.trys.push([1,4,,5]),i=this,[4,l.file_readAsync(t,r.encoding,n,o)];case 2:return i.content=e.sent(),[4,C("read",this,r,this.opts)];case 3:return e.sent(),[2,this.content];case 4:throw s=e.sent(),L(t)&&delete j[t],s;case 5:return[2]}})})},P.readAsync=function(e,t){return new P(e,t).readAsync(t)},P.prototype.readRange=function(e,t,r){var n=D(this.uri),r=E(r);return l.file_readRange(n,e,t,r.encoding)},P.readRange=function(e,t,r,n){return new P(e).readRange(t,r,n)},P.prototype.readRangeAsync=function(o,i,s){return S(this,function(r,n,e){var t=E(s);l.file_readRangeAsync(e,o,i,t.encoding,function(e,t){if(e)return r.reject(e);r.resolve(t,n)})})},P.readRangeAsync=function(e,t,r,n){return new P(e,n).readRangeAsync(t,r,n)},P.prototype.write=function(e,t){if(null!=e&&(this.content=e),null==this.content)return o.logger.error("io.file.write: Content is empty"),this;var r=D(this.uri),e=E(t);return H("write",this,e,t),l.file_save(r,this.content,e,q(t,this.opts)),this.content=null,this},P.write=function(e,t,r){return new P(e,r).write(t,r)},P.prototype.writeAsync=function(i,s){return u(this,void 0,Promise,function(){var t,r,n,o;return a(this,function(e){switch(e.label){case 0:if(t=D(this.uri),null==(i=null===i?this.content:i))throw new Error("Content is undefined");return this.content=i,r=R(s,this.opts),o=E(s),n=++this._ver,[4,C("write",this,o,this.opts)];case 1:return(e.sent(),n!==this._ver)?[2]:(o=this.content,this.content=null,[4,l.file_saveAsync(t,o,r,q(s,r))]);case 2:return e.sent(),[2,this]}})})},P.writeAsync=function(e,t,r){return new P(e,r).writeAsync(t,r)},P.prototype.copyTo=function(e,t){var r=D(this.uri),n=c.path_getUri(e),e=n.file?D(n):D(n.combine(m.uri_getFile(this.uri,null==t?void 0:t.baseSource)));return!0!==(null==t?void 0:t.silent)&&(n=r.substr(-25).replace(/([^\/]+)$/,"green<bold<$1>>").color,t=e.substr(-25).replace(/([^\/]+)$/,"green<bold<$1>>").color,f.log_info("copy:",n,t)),l.file_copy(r,e),this},P.copyTo=function(e,t,r){return new P(e).copyTo(t,r)},P.prototype.copyToAsync=function(o,i){return S(this,function(e,t,r){var n=c.path_getUri(o),n=n.file?D(n):D(n.combine(m.uri_getFile(this.uri,null==i?void 0:i.baseSource)));l.file_copyAsync(r,n,T(e))})},P.copyToAsync=function(e,t,r){return new P(e).copyToAsync(t)},P.prototype.exists=function(){var e=D(this.uri);return l.file_exists(e)},P.exists=function(e){return new P(e).exists()},P.prototype.existsAsync=function(){var e=D(this.uri);return l.file_existsAsync(e)},P.existsAsync=function(e){return new P(e).existsAsync()},P.prototype.rename=function(e){return l.file_rename(D(this.uri),e)},P.rename=function(e,t){return new P(e).rename(t)},P.prototype.renameAsync=function(n){return S(this,function(e,t,r){l.file_renameAsync(r,n,T(e))})},P.renameAsync=function(e,t){return new P(e).renameAsync(t)},P.prototype.append=function(e){return l.file_append(D(this.uri),e)},P.append=function(e,t){return new P(e).append(t)},P.prototype.appendAsync=function(n){return S(this,function(e,t,r){l.file_appendAsync(r,n,T(e))})},P.appendAsync=function(e,t){return new P(e).appendAsync(t)},P.prototype.remove=function(){return l.file_remove(D(this.uri))},P.remove=function(e){return new P(e).remove()},P.prototype.removeAsync=function(){return S(this,function(e,t,r){l.file_removeAsync(r,T(e))})},P.removeAsync=function(e){return new P(e).removeAsync()},P.prototype.replace=function(e,t,r){r=(r="string"!=typeof(r=this.read(r))?r.toString():r).replace(e,t);return this.write(r),r},P.replace=function(e,t,r,n){return new P(e).replace(t,r,n)},P.prototype.replaceAsync=function(r,n,o){return u(this,void 0,Promise,function(){var t;return a(this,function(e){switch(e.label){case 0:return[4,this.readAsync(o)];case 1:return t=(t=e.sent()).replace(r,n),[4,this.writeAsync(t)];case 2:return e.sent(),[2,t]}})})},P.replaceAsync=function(e,t,r,n){return new P(e).replaceAsync(t,r,n)},P.prototype.watch=function(e){d.Watcher.watch(D(this.uri),e)},P.watch=function(e,t){new P(e).watch(t)},P.prototype.unwatch=function(e){d.Watcher.unwatch(D(this.uri),e)},P.unwatch=function(e,t){new P(e).unwatch(t)},P.prototype.stats=function(){return p.fs_getStat(D(this.uri))},P.stats=function(e){return new P(e).stats()},P.clearCache=function(e){var t;!1!==O&&(0!==arguments.length?null!=e&&("string"==typeof e?(e.startsWith(k)&&(e="file://"+e),t=D(c.path_getUri(e)),!1===j.hasOwnProperty(t)&&47===e.charCodeAt(0)&&(t=i.class_Uri.combine(h.Env.cwd,e))):e.uri?t=D(e.uri):e.toLocalFile&&(t=D(e)),!1!==j.hasOwnProperty(t)?delete j[t]:o.logger.log("io.File - not in cache -",t)):j={})},P.disableCache=function(){O=!(j={})},P.enableCache=function(){O=!0},P.registerFactory=function(e){n=e},P.getFactory=function(){return n},P.registerHookHandler=function(e){s=e},P.getHookHandler=function(){return s},P.registerTransport=function(e,t){b.CustomTransport.register(e,t)},P.getTransports=function(){return b.CustomTransport.all()},P.setTransports=function(e){b.CustomTransport.set(e)},Object.defineProperty(P,"Factory",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(P,"Middleware",{get:function(){return s},enumerable:!1,configurable:!0}),P.processHooks=function(t,r,n,o){return u(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return[4,C(t,r,null,n)];case 1:return e.sent(),null!=o&&o(),[2]}})})},P.registerExtensions=function(e,t,r){v.FileHookRegistration.registerMiddlewares(e,t=void 0===t?!1:t,r=void 0===r?null:r)},P.setMiddlewares=function(e,t){v.FileHookRegistration.registerMiddlewares(e,!0,t=void 0===t?null:t)},P.middleware={},P);function P(e,t){this.opts=t,this._ver=0,"string"==typeof e&&"/"===e[0]&&e.startsWith(k)&&(e="file://"+e),this.uri=c.path_getUri(e);var r=D(this.uri);if(L(r,t))return j[r];if(this.__proto__===P.prototype){e=null!==(e=null==t?void 0:t.factory)&&void 0!==e?e:n,e=null==e?void 0:e.resolveHandler(this.uri);if(null!=e)return new e(this.uri,t)}return!1==(t=t,!1!==O&&(null==t||!1!==t.cached))?this:j[r]=this}function S(e,t,r){var n=new i.class_Dfr,o=D(e.uri);return null!=r&&n.fail(function(){r(e,o)}),t(n,e,o),n}function T(n){return function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e?n.reject(e):n.resolve.apply(n,t)}}function D(e){return null==e.protocol||"file"===e.protocol?e.toLocalFile():e.toString()}function E(e){var t={encoding:"utf8",skipHooks:!1,hooks:null,aes256:null};if(null==e)return t;switch(typeof e){case"string":t.encoding=e;break;case"object":Object.assign(t,e)}return"buffer"===t.encoding&&(t.encoding=null),t}function R(e,t){return r(r({},null!=t?t:{}),null!=e?e:{})}function M(e,t){t=null!==(e=null==e?void 0:e.aes256)&&void 0!==e?e:null==t?void 0:t.aes256;return null==t?null:w.Encrypt.delegateDecrypt(t)}function q(e,t){t=null!==(e=null==e?void 0:e.aes256)&&void 0!==e?e:null==t?void 0:t.aes256;return null==t?null:w.Encrypt.delegateEncrypt(t)}function H(e,t,r,n){var o=s;(null==r||null!=(o=r.hooks||o)&&!0!==r.skipHooks)&&o.trigger(e,t,n)}function C(r,n,o,i){return u(this,void 0,void 0,function(){var t;return a(this,function(e){return t=s,null==o||null!=(t=o.hooks||t)&&!0!==o.skipHooks?[2,A.cb_toPromiseCtx(t,t.triggerAsync,r,n,i)]:[2]})})}function L(e,t){return!1!==O&&((null==t||!1!==t.cached)&&(j.hasOwnProperty(e)&&null!=j[e]))}function I(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.File=F,x.global.io&&x.global.io.File&&"function"==typeof x.global.io.File.getFactory?(x=x.global.io.File,F.registerFactory(x.getFactory()),F.registerHookHandler(x.getHookHandler()),F.middleware=x.middleware,x.getTransports&&F.setTransports(x.getTransports())):(y=new y.FileFactory,g=new g.FileHooks,F.registerFactory(y),F.registerHookHandler(g),g.register(/\.json$/,"read",_.JsonMiddleware),g.register(/\.json$/,"write",_.JsonMiddleware)),I(N)&&I(t.exports)?Object.assign(N,t.exports):N=t.exports}(),function(){var n,e=null!=A?A:{},t={exports:e},r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.cli_confirm=e.cli_prompt=void 0;var o,i,s=require("atma-utils");e.cli_prompt=function(e,t){c.create(new l(e,t))},e.cli_confirm=function(e,t){c.create(new h(e+" (y): ",t))};var c=(u.create=function(e){var t;null==o&&(t=require("readline"),o=t.createInterface({input:process.stdin,output:process.stdout}),i=new u),i.collection.push(e),i.process()},u.prototype.process=function(){this.busy||0!==this.collection.length&&(this.busy=!0,this.collection.shift().process().always(this.next))},u.prototype.next=function(){this.busy=!1,this.process()},u);function u(){this.collection=[],this.busy=!1,this.process=this.process.bind(this),this.next=this.next.bind(this)}var a,l=(a=s.class_Dfr,r(f,a),f.prototype.process=function(){return o.resume(),process.stdout.write("\n"),o.question(this.text,this.onInput.bind(this)),this},f.prototype.onInput=function(e){o.pause(),this.callback&&this.callback(e),this.resolve(e)},f);function f(e,t){void 0===e&&(e=">");var r=a.call(this)||this;return r.text=e,r.callback=t,r}var p,h=(r(d,p=l),d.prototype.onInput=function(e){e?p.prototype.onInput.call(this,e):this.process()},d);function d(e,t){var t=p.call(this,e,t)||this,r=t.callback;return t.callback=function(e){r(/^y|yes$/gi.test(e))},t}function y(e){return null!=e&&"object"==typeof e&&e.constructor===Object}y(A)&&y(t.exports)?Object.assign(A,t.exports):A=t.exports}(),function(){var e=null!=O?O:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.stack_formatCaller=void 0;var i,s={path:null,file:null,line:null};function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.stack_formatCaller=function(e){void 0===e&&(e="P:L");for(var t,r=(new Error).stack.split("\n").splice(1),n=r.length,o=-1;++o<n&&(null==(t=function(e){")"===e[e.length-1]&&(e=e.substr(e.indexOf("(")+1,e.lastIndexOf(")")-1));var t=/^(.+):(\d+):(\d)/.exec(e);return null==t?null:(e=s.path=t[1],s.file=e.substring(e.search(/[\/\\][^\/\\]+$/)+1),s.line=t[2],null==i&&(i=s.file),s)}(r[o]))||null==i||t.file===i););return null==t||o===n?"":e.replace("P",t.path).replace("F",t.file).replace("L",t.line)},r(O)&&r(t.exports)?Object.assign(O,t.exports):O=t.exports}(),function(){var e=null!=w?w:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitCallbacks=void 0;var r=require("atma-utils"),n=(o.prototype.delegate=function(){var t=this;return this.completed=!1,this.promise.defer(),this.wait++,function(e){if(!t.completed)return e?(t.completed=!0,void t.promise.reject(e)):void(--t.wait<1&&(t.completed=!0,t.promise.resolve()))}},o);function o(){this.promise=new r.class_Dfr,this.error=null,this.completed=!1,this.wait=0,this.promise.resolve()}function i(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.AwaitCallbacks=n,i(w)&&i(t.exports)?Object.assign(w,t.exports):w=t.exports}(),function(){var e=null!=x?x:{},t={exports:e},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var i=arguments[t],s=0,c=i.length;s<c;s++,o++)n[o]=i[s];return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Directory=void 0;var r=z,f=require("atma-utils"),s=m,c=j,p=N,h=ee,d=A,n=G,o=O,u=U,l=w,a=(y.prototype.exists=function(){return s.dir_exists(b(this.uri))},y.exists=function(e){return new y(e).exists()},y.prototype.existsAsync=function(){return g(this,function(e,t,r){s.dir_existsAsync(r,v(e))})},y.existsAsync=function(e){return new y(e).existsAsync()},y.prototype.ensure=function(){return s.dir_ensure(b(this.uri)),this},y.ensure=function(e){return new y(e).ensure()},y.prototype.ensureAsync=function(){return g(this,function(e,t,r){s.dir_ensureAsync(r,v(e,t))})},y.ensureAsync=function(e){return new y(e).ensureAsync()},y.prototype.readFiles=function(e,t){var r=this,e=c.glob_parsePatterns(e),t=c.glob_parsePatterns(t),n=this.files=s.dir_files(b(this.uri),e,t).map(function(e){return new p.File(r.uri.combine(e))});return Object.defineProperty(n,"files",{get:function(){return console.log("Warn: obsolete. io.Directory::readFiles returns now the array of files"),o.stack_formatCaller(),n}}),n},y.readFiles=function(e,t,r){return new y(e).readFiles(t,r)},y.prototype.read=function(e,t){var r=this,e=c.glob_parsePatterns(e),t=c.glob_parsePatterns(t);return s.dir_files(b(this.uri),e,t,{directories:!0}).map(function(e){var t=r.uri.combine(e);return new("/"===e[e.length-1]?y:p.File)(t)})},y.read=function(e,t,r){return new y(e).read(t,r)},y.prototype.readFilesAsync=function(e,t){var o=c.glob_parsePatterns(e);c.glob_parsePatterns(t);return g(this,function(r,n,e){s.dir_filesAsync(e,o,t,function(e,t){e?r.reject(e):(n.files=t.map(function(e){var t=new f.class_Uri(e);return t.isRelative()&&(t=n.uri.combine(e)),new p.File(t)}),r.resolve(n.files))})})},y.readFilesAsync=function(e,t,r){return new y(e).readFilesAsync(t,r)},y.prototype.readAsync=function(e,t){var o=c.glob_parsePatterns(e);c.glob_parsePatterns(t);return g(this,function(r,n,e){s.dir_filesAsync(e,o,t,{directories:!0},function(e,t){e?r.reject(e):(t=t.map(function(e){var t=n.uri.combine(e);return new("/"===e[e.length-1]?y:p.File)(t)}),r.resolve(t,n))})})},y.readAsync=function(e,t,r){return new y(e).readAsync(t,r)},y.prototype.copyTo=function(e,o){void 0===o&&(o={verbose:!1});var i=new f.class_Dfr;!1===Array.isArray(this.files)&&this.readFiles();var s=this.uri,c=h.path_getUri(e),u=this.files,a=u.length,l=-1;return function t(){var r,e,n;++l>=a?i.resolve():(e=(r=u[l]).uri.toRelativeString(s),n=c.combine(e),!0!==o.verbose&&p.File.exists(n)?d.cli_prompt("File already exists: "+e+". Replace? ",function(e){e&&r.copyTo(n),t()}):(r.copyTo(n),t()))}(),i},y.copyTo=function(e,t,r){return void 0===r&&(r={verbose:!1}),new y(e).copyTo(t,r)},y.prototype.copyToAsync=function(e,i){var t=this;void 0===i&&(i={verbose:!1});var r=new f.class_Dfr;if(!1===Array.isArray(this.files))return this.readFilesAsync().done(function(){t.copyToAsync(e,i).done(r.resolveDelegate()).fail(r.rejectDelegate())}).fail(r.rejectDelegate()),r;for(var s=this.uri,c=h.path_getUri(e),u=this.files,n=u.length,o=-1,a=new l.AwaitCallbacks;++o<n;)!function(e,t){var r,n=u[e],e=n.uri.toRelativeString(s);function o(){t()}r=c.combine(e),!0!==i.verbose&&p.File.exists(r)?(e="File already exists: "+e+". Replace? ",d.cli_prompt(e,function(e){!0===e&&n.copyToAsync(r).done(o).fail(t)})):n.copyToAsync(r).done(o).fail(t)}(o,a.delegate());return a.promise.done(r.resolveDelegate()).fail(r.rejectDelegate()),r},y.copyToAsync=function(e,t,r){return void 0===r&&(r={verbose:!1}),new y(e).copyToAsync(t,r)},y.prototype.getName=function(){return/([^\/]+)\/?$/.exec(this.uri.path)[1]},y.prototype.rename=function(e){var t;e?(e=(t=this.uri.toLocalFile()).replace(/[^\/]+\/?$/g,e),r.logger.log("<dir:rename>",t,e),s.dir_rename(t,e)):r.logger.error("<dir:rename> New Name is not defined")},y.rename=function(e,t){new y(e).rename(t)},y.prototype.renameAsync=function(o){return g(this,function(e,t,r){var n;o?(n=r.replace(/[^\/]+\/?$/g,o),s.dir_renameAsync(r,n,v(e))):e.reject("Name is undefined")})},y.renameAsync=function(e,t){return new y(e).renameAsync(t)},y.prototype.remove=function(){s.dir_remove(b(this.uri))},y.remove=function(e){new y(e).remove()},y.prototype.removeAsync=function(){return g(this,function(e,t,r){s.dir_removeAsync(r,v(e))})},y.removeAsync=function(e){return new y(e).removeAsync()},y.prototype.watch=function(e){n.Watcher.watch(this.uri.toLocalFile(),e)},y.watch=function(e,t){new y(e).watch(t)},y.prototype.unwatch=function(e){n.Watcher.unwatch(this.uri.toLocalFile(),e)},y.unwatch=function(e,t){new y(e).unwatch(t)},y.symlink=s.dir_symlink,y);function y(e){if(e instanceof y)return e;null!=e&&"/"!==e?("string"==typeof e&&"/"!==e[e.length-1]&&(r.logger.warn("@ directory path should end with slash. Adding...",e),!1===/\.\w+$/.test(e)&&(e+="/")),this.uri=h.path_getUri(e),delete this.uri.file):this.uri=u.Env.currentDir}function g(e,t){var r=new f.class_Dfr;return t(r,e,b(e.uri)),r}function v(n){for(var o=[],e=1;e<arguments.length;e++)o[e-1]=arguments[e];return function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e?n.reject(e):n.resolve.apply(n,i(o,t))}}function b(e){var t=null==e.protocol||"file"===e.protocol,r=t?e.toLocalDir():null;return!1==t&&((e=new f.class_Uri(e)).file=null,r=e.toString()),r}function _(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.Directory=a,_(x)&&_(t.exports)?Object.assign(x,t.exports):x=t.exports}(),function(){var e=null!=i?i:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.Glob=void 0;var n=j,o=x;function r(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.Glob={matchPath:n.glob_matchPath,readFiles:function(e){var t=n.glob_getStrictPath(e),e=n.glob_getRelativePath(e);return new o.Directory(t).readFiles(e)},read:function(e){var t=n.glob_getStrictPath(e),e=n.glob_getRelativePath(e);return new o.Directory(t).read(e)},readAsync:function(e,r){var t=n.glob_getStrictPath(e),e=n.glob_getRelativePath(e);return new o.Directory(t).readAsync(e).done(function(e,t){r(null,e,t)}).fail(function(e){r(e)})}},r(i)&&r(t.exports)?Object.assign(i,t.exports):i=t.exports}(),function(){var e=null!=o?o:{},t={exports:e};Object.defineProperty(e,"__esModule",{value:!0}),e.setSettings=void 0;var r=N;function n(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.setSettings=function(e){e.extensions&&r.File.registerExtensions(e.extensions,!0)},n(o)&&n(t.exports)?Object.assign(o,t.exports):o=t.exports}(),function(){var n,e=null!=u?u:{},t={exports:e},r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.FileSafe=void 0;var i,r=(i=N.File,r(s,i),s);function s(e,t){var r=i.call(this,e,o(o({},null!=t?t:{}),{processSafe:!0}))||this;return r.path=e,r.opts=t,r}function c(e){return null!=e&&"object"==typeof e&&e.constructor===Object}e.FileSafe=r,c(u)&&c(t.exports)?Object.assign(u,t.exports):u=t.exports}();var l=require("atma-utils"),k=z,F=U,P=G,S=i,T=N,D=x,E=o,R=u,M=g;k.io.env=F.Env,k.io.watcher=P.Watcher,k.io.glob=S.Glob,k.io.File=T.File,k.io.FileSafe=R.FileSafe,k.io.LockFile=M.LockFile,k.io.Uri=l.class_Uri,k.io.Directory=D.Directory,k.io.settings=E.setSettings,null==k.global.io&&(k.global.io=k.io),module.exports=k.io}();