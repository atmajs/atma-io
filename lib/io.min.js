(function(e,r){"use strict";var t,n;"undefined"==typeof exports||e!==exports&&null!=e||(t=n=global),null==t&&(t="undefined"==typeof window?global:window),null==n&&(n=e||t),r(t,n)})(this,function(global,exports){"use strict";function obj_extend(e,r){if(null==e&&(e={}),null==r)return e;for(var t in r)e[t]=r[t];return e}function arr_eachOrSingle(e,r){for(var t=arr_isArray(e),n=t?e.length:1,i=0,o=null;n>i&&(o=t?e[i]:e,r(o,i)!==!1);i++);return e}function arr_any(e,r){if(arr_isArray(e)===!1)return!1;for(var t,n=0,i=e.length;i>n;n++)if(t=e[n],r(t,n))return!0;return!1}function arr_each(e,r){for(var t,n=0,i=e.length;i>n&&(t=e[n],r(t,n)!==!1);n++);return e}function arr_isArray(e){return Array.isArray(e)}function path_combine(e,r){return e?r?("/"===r[0]&&(r=r.substring(1)),"/"===e[e.length-1]?e+r:e+"/"+r):e:r}function path_getDir(e){if(!e)return"/";var r=e.lastIndexOf("/");return-1===r?"":e.substring(r+1,-r)}function path_isSubDir(e,r){var t=path_getDir(e),n=path_getDir(r);return 0===n.toLowerCase().indexOf(t.toLowerCase())}function path_resolveUri(e,r,t){"/"===e[0]&&(r=t,e=e.substring(1));var n=new net.Uri(e);return n.isRelative()?new net.URI(r).combine(n):n}function path_resolveAppUri(e,r){if("/"===e[0])return e;if("./"===e.substring(0,2)&&(e=e.substring(2)),!r||"file"===e.substring(0,4))return"/";var t=r.lastIndexOf("/");return(-1===t?"/":r.substring(t+1,-t))+e}function path_ensureTrailingSlash(e){return"/"===e[e.length-1]?e:e+"/"}function fs_isDirectory(e){try{return __fs.statSync(e).isDirectory()}catch(r){return!1}}function fs_getStat(e){try{return __fs.statSync(e)}catch(r){return null}}function dir_ensure(e){if("/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),__fs.existsSync(e)===!1){var r,t=e.substring(0,e.lastIndexOf("/"));if(t&&(r=dir_ensure(t)),r)return""+r;try{__fs.mkdirSync(e)}catch(n){return""+n}}return fs_isDirectory(e)?void 0:"Target exists, but is not a directory:"+e}function dir_exists(e){return __fs.existsSync(e)===!1?!1:fs_isDirectory(e)}function dir_files(e,r,t){var n=0;return r&&r.forEach(function(e){e.depth>n&&(n=e.depth)}),dir_walk(e,"",{depth:0,maxdepth:n||1/0,patterns:r,excludes:t})}function dir_symlink(e,r){try{__fs.symlinkSync(e,r,"junction")}catch(t){logger.error("symlink: bold<%s>",t)}}function dir_walk(e,r,t){var n,i=[];try{n=__fs.readdirSync(e)}catch(o){return console.error("<dir walk>",o),i}null==r&&(r=""),null==t&&(t={depth:0,maxdepth:1/0});var a=t.depth,s=t.patterns,l=t.excludes;t.depth++;for(var c,u=0,f=n.length;f>u;u++){c=n[u];var g=__fs.lstatSync(path_combine(e,c)),d=path_combine(r,c),h=!0;if(g.isDirectory()){if(g.isSymbolicLink())continue;if(t.depth>=t.maxdepth)continue;var p=path_combine(r,c);if(s){for(var m=!1,v=0,_=s.length;_>v;v++){var y=s[v].rootCount-a,b=s[v].root;if(!y||a>y){m=!0;break}if(0===b.indexOf(p)){m=!0;break}logger(90).warn("<glob> not matched %s | %s",p,b)}if(m===!1)continue}logger(90).warn("<glob> match sub-",p),i=i.concat(dir_walk(path_combine(e,c),p,t))}else{if(s){h=!1;for(var v=0,_=s.length;_>v;v++)if(s[v].test(d)){h=!0;break}}if(h&&l)for(var v=0,_=l.length;_>v;v++)if(l[v].test(d)){h=!1;break}h&&i.push(d)}}return t.depth=a,i}function file_save(e,r){var t;if(t=dir_ensure(path_getDir(e)))return logger(99).error("io.utils:file.save",e);try{__fs.writeFileSync(e,r)}catch(t){logger.log("red<.save()>: red<bold<%s>>".color,t)}}function file_copy(e,r){var t;if(__fs.existsSync(e)===!1)return logger.error("file/copy - red<404 Error>".color,e);if(t=dir_ensure(path_getDir(r)))return logger(99).error("io.utils:file.copy",r);try{file_performCopySync(e,r)}catch(t){logger.error("<file:copy> - ",t)}}function file_exists(e){return __fs.existsSync(e)&&__fs.statSync(e).isFile()}function file_read(e,r){try{return __fs.readFileSync(e,r)}catch(t){logger.log("red<.read():> red<bold<%s>>".color,""+t)}return""}function file_remove(e){if(file_exists(e)===!1)return logger.error("<file:remove> File 404 - ",e),!1;try{__fs.unlinkSync(e)}catch(r){return logger.error("<file:remove>",""+r),!1}return!0}function file_rename(e,r){if(file_exists(e)===!1)return logger.error("<file:rename> File 404 - ",e),!1;var t=e.lastIndexOf("/"),n=e.substring(0,t+1);if(!n)return logger.error("<file:rename> invalid directory from path",e),!1;try{__fs.renameSync(e,n+r)}catch(i){return logger.error("<file:rename>",""+i),!1}return!1}function file_performCopySync(e,r){for(var t=65536,n=new Buffer(t),i=1,o=__fs.openSync(e,"r"),a=__fs.openSync(r,"w"),s=0;i>0;)i=__fs.readSync(o,n,0,t,s),__fs.writeSync(a,n,0,i),s+=i;return __fs.closeSync(o),__fs.closeSync(a)}function cfg_get(){var e=io.env.settings,r={};if(e)for(var t in e)r[t]=e[t];if(!!(global.app&&app.config&&app.config.tasks)==!1)return r;var n=app.current||app.config.tasks[0];if(n)for(var t in n)r[t]=n[t];return r}function toDir(e){return net.Uri.combine(normalizePath(e),"/")}function normalizePath(e){return e.replace(/\\/g,"/")}var io={},atma=void 0!==atma?atma:global;null==atma.Class&&(atma=require("atma-libs/exports")),null==global.logger&&require("atma-logger");var __fs=require("fs"),net=atma.net,Class=atma.Class,logger=global.logger,glob_getCalculatedPath,glob_matchPath,glob_parsePatterns,glob_parseDirs,glob_toRegExp,glob_getStrictPath,glob_getRelativePath;(function(){glob_getCalculatedPath=function(e,r){var t=r.indexOf("*"),n=r.lastIndexOf("/",t),i=-1===n?null:r.substring(0,n);if(!n)return e;var o=e.toLowerCase().indexOf(i.toLowerCase());return-1===o?(logger.warn("[substring not found]",e,i),e):e.substring(o+i.length)},glob_matchPath=function(e,r){return"/"===r[0]&&(r=r.substring(1)),"/"===e[0]&&(e=e.substring(1)),glob_toRegExp(e).test(r)},glob_parsePatterns=function(e,r){if(null==e)return null;if(null==r&&(r=[]),Array.isArray(e))return e.forEach(function(t){e(t,r)}),r;if(e instanceof RegExp)return r.push(e),r;if("string"==typeof e){var t=e;"/"===t[0]&&(t=t.substring(1));var n=glob_toRegExp(t),i=glob_parseDirs(t);return n.depth=i[0],n.rootCount=i[1],n.root=i[2],r.push(n),r}return logger.error("<glob> Unsupported pattern",t),r},glob_parseDirs=function(e){"/"===e[0]&&(e=e.substring(1));var r=0,t=e.split("/");r=-1!==e.indexOf("**")?1/0:t.length,t.pop();for(var n=0;t.length>n;n++)-1!==t[n].indexOf("*")&&t.splice(n);return[r,t.length,t.join("/").toLowerCase()]},glob_toRegExp=function(e){var r="\\^$*+?.()|{}[]",t="",n=-1,i=e.length;for(e=e.replace(/(\*\*\/){2,}/g,"**/");i>++n;){var o=e[n];switch(o){case"?":t+=".";break;case"*":if("*"===e[n+1]){0===n&&/[\\\/]/.test(e[n+2])&&(t+=".+",n+=2),t+=".+",n++;break}t+="[^/]+";break;case"{":var a=e.indexOf("}",n);if(~a){t+="("+e.substring(n+1,a).replace(/,/g,"|")+")",n=a;break}t+=o;break;case"[":var a=e.indexOf("]",n);if(~a){t=e.substring(n,a),n=a;break}t+=o;break;default:~r.indexOf(o)&&(t+="\\"),t+=o}}return t="^"+t+"$",RegExp(t,"i")},glob_getStrictPath=function(e){var r=e.indexOf("*");return-1===r?(logger.error("glob.js [path is not a glob pattern]",e),null):e.substring(0,e.lastIndexOf("/",r)+1)},glob_getRelativePath=function(e){var r=e.indexOf("*");return-1===r?(logger.error("glob.js [path is not a glob pattern]",e),null):e.substring(e.lastIndexOf("/",r)+1)}})();var mainFile=new net.Uri(normalizePath(process.mainModule.filename)),platform=process.platform,__cwd=toDir(process.cwd());io.env={applicationDir:new net.Uri(mainFile.toDir()),currentDir:new net.Uri(__cwd),get newLine(){return Object.defineProperty(this,"newLine",{value:require("os").EOL}),this.newLine},get appdataDir(){var e;switch(platform){case"win32":case"win64":e=process.env.APPDATA||process.env.HOME;break;case"darwin":e=process.env.HOME;break;default:e=process.env.HOME}return null==e?(logger.error("<io.env> Unknown AppData Dir"),Object.defineProperty(this,"appdataDir",{value:this.applicationDir}),this.applicationDir):(e=new net.Uri(toDir(e)),"darwin"===platform&&(e=e.combine("Library/Application Support/")),e=e.combine("."+mainFile.file+"/"),Object.defineProperty(this,"appdataDir",{value:e}),e)}},function(){var e,r,t={};io.File=Class({Construct:function(e,n){if("string"!=typeof e&&(e=""+e),this.uri=new net.Uri(e),e&&this.uri.isRelative()&&io.env&&(this.uri=io.env.currentDir.combine(this.uri)),e=this.uri.toLocalFile(),t.hasOwnProperty(e))return t[e];if(this.__proto__===io.File.prototype){var i=r&&r.resolveHandler(this.uri);if(i)return new i(this.uri,n)}return t[e]=this},read:function(r){if(this.content)return this.content;var t="utf-8",n=!1;if(null!=r){switch(typeof r){case"string":t=r;break;case"object":r.hasOwnProperty("encoding")&&(t=r.encoding),r.hasOwnProperty("skipHooks")&&(n=r.skipHooks)}"buffer"===t&&(t=null)}return this.content=file_read(this.uri.toLocalFile(),t),e&&n!==!0&&e.trigger("read",this,r),this.content},write:function(r){return null!=r&&(this.content=r),null==this.content?(logger.error("io.file.write: Content is empty"),this):(e&&e.trigger("write",this),file_save(this.uri.toLocalFile(),this.content),this)},copyTo:function(e){"string"==typeof e&&(e=new net.Uri(e),e.isRelative()&&(e=io.env.currentDir.combine(e)));var r=this.uri.toLocalFile(),t=e.toLocalFile(),n=r.substr(-25).replace(/([^\/]+)$/,"green<bold<$1>>").color,i=t.substr(-25).replace(/([^\/]+)$/,"green<bold<$1>>").color;return logger.log("Copy:",n,i),file_copy(r,t),this},exists:function(){return file_exists(this.uri.toLocalFile())},rename:function(e){return file_rename(this.uri.toLocalFile(),e)},remove:function(){return file_remove(this.uri.toLocalFile())},watch:function(e){io.watcher.watch(this.uri.toLocalFile(),e)},unwatch:function(e){io.watcher.unwatch(this.uri.toLocalFile(),e)},Static:{clearCache:function(e){return e?(47===e.charCodeAt(0)&&(e=net.Uri.combine(__cwd,e)),t.hasOwnProperty(e)?(delete t[e],void 0):(logger.log("io.File - not in cache -",e),void 0)):(t={},void 0)},registerFactory:function(e){r=e},getFactory:function(){return r},registerHookHandler:function(r){e=r},getHookHandler:function(){return e}},stats:function(){return fs_getStat(this.uri.toLocalFile())}})}(),function(){["exists","read","write","remove","copyTo"].forEach(function(e){io.File[e]=function(){var r=arguments[0],t=Array.prototype.slice.call(arguments,1),n=new io.File(r);return n[e].apply(n,t)}})}();var Directory=io.Directory=Class({Construct:function(e){return e instanceof Directory?e:null==e||"/"===e?(this.uri=io.env.currentDir,void 0):("string"==typeof e&&"/"!==e[e.length-1]&&logger.warn("@ directory path should end with slash",e),this.uri=new net.Uri(e),this.uri.isRelative()&&io.env&&(this.uri=io.env.currentDir.combine(this.uri)),delete this.uri.file,void 0)},exists:function(){return dir_exists(this.uri.toLocalDir())},ensure:function(){return dir_ensure(this.uri.toLocalDir()),this},readFiles:function(e,r){var t=glob_parsePatterns(e),n=glob_parsePatterns(r),i=this;return this.files=dir_files(this.uri.toLocalDir(),t,n).map(function(e){return new io.File(i.uri.combine(e))}),this},copyTo:function(e,r,t,n){if(Array.isArray(this.files)===!1)return logger.warn("<dir.copyTo> No files to copy"),this;for(var i,o=t||0,a=this.files.length;a>o;o++){i=this.files[o];var s=i.uri.toRelativeString(this.uri),l=new io.File(this.uri.combine(s));if(r&&-1===r.indexOf("-v")&&l.exists())return program.prompt("File already exists: #{file}. Replace(y/n)? ".format({file:l.uri.toLocalFile()}),this.copy.bind(this,e,r,o,n)),this;i.copyTo(e.combine(s))}return n&&n.resolve&&n.resolve(),this},getName:function(){return this.uri.path.replace(/^.*\/([^\/]+)\/?$/,"$1")},rename:function(e){if(!e)return logger.error("<dir:rename> New Name is not defined"),void 0;var r=this.uri.toLocalFile(),t=r.replace(/[^\/]+\/?$/g,e);logger.log("<dir:rename>",r,t),__fs.renameSync(r,t)},watch:function(e){io.watcher.watch(this.uri.toLocalFile(),e)},unwatch:function(e){io.watcher.unwatch(this.uri.toLocalFile(),e)},Static:{symlink:dir_symlink}});return function(){var e=[],r=Class({Construct:function(e,r,t,n){this.regexp=e,this.name=r,this.handler=t,this.zIndex=n},run:function(e,r,t){e===this.name&&this.regexp.test(""+r.uri)!==!1&&this.handler(r,t)},canHandle:function(e,r){return null!=r&&r!==this.name?!1:this.regexp.test(e)}});io.File.registerHookHandler({register:function(t,n,i,o){var a=t;if(1===arguments.length&&(a=t.regexp,n=t.method,i=t.handler,o=t.zIndex),"string"==typeof i&&(i=io.File.middleware[i],null==i))throw logger.error("Invalid hook handler - ",i),Error("Handler not Found by name");return this.contains(n,i)===!1&&e.push(new r(a,n,i,o||0)),this},contains:function(r,t){for(var n,i=e.length;--i>-1;)if(n=e[i],n.name===r&&n.handler===t)return!0;return!1},unregister:function(r,t){"string"==typeof t&&(t=io.File.middleware[t]),e=e.filter(function(e){return e.name!==r&&e.handler!==t})},trigger:function(e,r,t){return this.getHooksForPath(""+r.uri,e).sort(function(e,r){var t=e.zIndex,n=r.zIndex;return t===n?0:e.zIndex<r.zIndex?1:-1}).forEach(function(n){n.run(e,r,t)}),this},clear:function(){return e=[],this},getHooksForPath:function(r,t){return e.filter(function(e){return e.canHandle(r,t)})}})}(),function(){function e(e){var t;return arr_each(r,function(r){return arr_eachOrSingle(r.regexp,function(n){n.lastIndex=0,n.test(e)&&(t=r)}),t?!1:void 0}),t}var r=[];io.File.registerFactory({registerHandler:function(e,t){r.push({handler:t,regexp:e})},resolveHandler:function(r){var t=""+r,n=e(t);return n?n.handler:null}})}(),function(){var e="change",r={};io.watcher={watch:function(n,i){return r[n]?(r[n].on(e,i),void 0):__fs.existsSync(n)===!1?(logger.error("<watcher> File not exists",n),void 0):(r[n]=new t(n),r[n].on(e,i),void 0)},unwatch:function(t,n){var i=r[t];return null==i?(logger.warn("<watcher> No exists",t),void 0):(n&&(i.off(e,n),0!==i._listeners.length)||(i.close(),delete r[t]),void 0)}};var t=Class({Base:Class.EventEmitter,Construct:function(e){this.path=e,this.fswatcher=__fs.watch(e,this.changed)},Self:{changed:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.reportChange,100)},reportChange:function(){this.trigger(e,this.path)}},close:function(){this.fswatcher.close(),this.off()}})}(),function(){function registerMiddleware(e){var r=io.File.getHookHandler();for(var t in e){var n=e[t];arr_isArray(n)!==!1?arr_each(n,registerHookDelegate(r,t)):logger.warn("Middleware list for %s is not an array",t)}}function registerHookDelegate(e,r){return function(t){registerHook(e,r,t)}}function registerHook(e,r,t){var n=t.split(":"),i=n[0],o=n[1],a=io.File.middleware[i];return null==a?(logger.error("Middleware not defined",i),void 0):"object"==typeof a&&(a=a[o],null==a)?(logger.error("Middleware not defined for action",o,i),void 0):(e.register(RegExp("\\."+r+"$"),o,a),void 0)}io.File.middleware={},function(){var e=require("jshint").JSHINT;io.File.middleware.hint=function(r,t){if(t=null!=t&&"object"==typeof t?t.jshint:cfg_get().jshint,null!=t){var n=t.globals,i=t.options,o=t.ignore,a=t.nolog;if(!(r.uri.file.indexOf(".min.")>-1||o&&o.hasOwnProperty(r.uri.file))){"string"!=typeof r.content&&(r.content=""+r.content);var s=Date.now(),l=e(r.content,i,n);if(logger.log("%s [%sms] %s",l?"Success".green:("Warn "+e.errors.length).red,Date.now()-s,r.uri.file),!l&&!a){var c,u,f=io.File.middleware.importer,g=r.uri.toLocalFile(),d=f.map_parse(r.content,g);e.errors.forEach(function(e){if(e){d&&(c=f.map_getFileAt(d,e.line),null==c?e.line>d[0].start&&logger.error("<hint:importedFile> file not resolved at",e.line):((null==u||u.file!==c.file)&&logger.log(" ",c.file.trim().magenta),u=c,e.line-=c.start));var r=e.evidence,t=e.character;logger.log("[yellow<%s>:yellow<%s>] bold<%s>".color,"L"+e.line,"C"+t,e.reason),r&&logger.log("  "+r.trim().cyan)}})}}}}}(),function(){var e=require("uglify-js");global.UglifyJS=e,io.File.middleware.uglify=function(r,t){null==t&&(t=cfg_get());var n=t.minify;if(n||"string"!=typeof r.content){logger.log("Uglify... [start]").log("");var i;i=n?t.uglify||{global_defs:{DEBUG:!1}}:{sequences:!1,properties:!1,dead_code:!1,drop_debugger:!1,unsafe:!1,conditionals:!1,comparisons:!1,evaluate:!1,booleans:!1,loops:!1,unused:!1,hoist_funs:!1,hoist_vars:!1,if_return:!1,join_vars:!1,cascade:!1,side_effects:!1,global_defs:{DEBUG:!1}};var o,a,s=Date.now();if("defines"in t&&(i.global_defs=t.defines),o=e.Compressor(i),a=r.content,"string"==typeof a)try{a=e.parse(r.content,{filename:r.uri.toLocalFile()})}catch(l){return logger.error("<uglify>:",l.message),void 0}a.figure_out_scope(),a=a.transform(o),n&&(a.figure_out_scope(),a.compute_char_frequency(),a.mangle_names()),r.content=a.print_to_string({beautify:!n,comments:/^!/}),logger.log("Uglify... [end %sms]",Date.now()-s)}}}(),io.File.middleware.cssmin=function(e,r){null==r&&(r=cfg_get()),r.minify&&(e.content=require("clean-css").process(e.content))},io.File.middleware.coffee=function(e){var r=require("coffee-script");"string"!=typeof e.content&&(e.content=""+e.content),e.content=r.compile(e.content)},function(){io.File.middleware.less=function(e){var r=e.uri.toLocalFile(),t=require("less"),n=new t.Parser({syncImport:!0,filename:r,paths:[e.uri.toLocalDir()]});"string"!=typeof e.content&&(e.content=""+e.content),n.parse(e.content,function(t,n){if(t)return logger.error("Less Parser:",r,t),void 0;try{e.content=n.toCSS()}catch(t){logger.error("Less Builder:",r,t)}})}}(),function(){function process(code,index,defines){reg_expression.lastIndex=index||0;var match=reg_expression.exec(code);if(null==match)return code;var expression=match[4],expressionEnd=match.index+match[0].length,doAction=null;try{doAction=!!eval(stringifyDefines(defines)+";"+expression)}catch(error){logger.warn("Conditional derective: ",""+error)}reg_inlineEnd.lastIndex=match.index;var reg_inlineEndMatch=reg_inlineEnd.exec(code),area="//"===match[1]||reg_inlineEndMatch&&reg_inlineEndMatch.index===match.index?"uncommented":"commented",out={index:expressionEnd,derectiveStart:match.index};return"commented"===area&&doAction===!0?code=uncomment(code,out):"uncommented"===area&&doAction===!1?code=comment(code,out):out.index=match.index+1,process(code,out.index,defines)}function uncomment(e,r){reg_commentEnd.lastIndex=r.index;var t=reg_commentEnd.exec(e),n=t.index+t[0].length,i=e.substring(0,r.derectiveStart)+e.substring(r.index,t.index)+e.substring(n);return r.index=r.derectiveStart+(t.index-r.index),i}function comment(e,r){reg_endIf.lastIndex=r.index;var t=reg_endIf.exec(e),n=e.substring(0,r.derectiveStart)+e.substring(t.index+t[0].length);return r.index=r.derectiveStart,n}function stringifyDefines(e){if(!e)return"";var r=[];for(var t in e)switch(typeof e[t]){case"string":r.push(String.format('var %1="%2"',t,e[t]));continue;case"number":case"boolean":r.push(String.format("var %1=%2",t,e[t]));continue;case"object":r.push(String.format("var %1=%2",t,JSON.stringify(e[t])));continue}return r.join(";")}io.File.middleware.condcomments=function(e,r){var t,n=e.content;r=r||cfg_get(),null!=r&&(t=r.defines||r.uglify&&r.uglify.global_defs,null!=t&&("string"!=typeof n&&(n=""+n),e.content=process(n,0,t)))};var reg_commentEnd=/\*\//g,reg_inlineEnd=/\/\*[ \t]*if[^\n\r]+\*\//g,reg_endIf=/(\/\*[\t ]*endif[\t ]*\*\/)|([ \t]*\/\/[ \t]*endif[ \t]*$)/gm,reg_expression=/^[ \t]*((\/\/)|(\/\*))[ \t]*if[ \t]*(([^\s]+$)|(\([^)\n\r]+\)))/gm}(),function(){function e(e){var t=e.content;"string"!=typeof t&&(t=""+t),o.test(t)&&(e.content=r(e.uri,t))}function r(e,r){return r.replace(o,function(r,n,i,o,a){var s,l,c,u=i||a;if(!u)return logger.error("Path can not be extracted",r),r;if(s="/"===u[0]?io.env.currentDir.combine(u.substring(1)):e.combine(u),-1!==u.indexOf("*")){var f=s.toLocalFile();c=new io.Directory(glob_getStrictPath(f)).readFiles(glob_getRelativePath(f)).files}if(null==c){var l=new io.File(s);if(l.exists()===!1)return logger.error("File Importer: File does not exists",l.uri.toLocalFile()).error("--",u,""+e,io.env.currentDir.toLocalFile()),r;c=[l]}var g=r.substring(0,r.indexOf("//")),d=c.map(function(r){var n="File Import %1 into %2".green.format(s.file,e.file);return logger.log(n),t(r,g,c.length>1)}).join(io.env.newLine);return r.replace("import","source")+io.env.newLine+d+io.env.newLine+r.replace("import","end:source")})}function t(e,r,t){var n=""+e.read();if(r){var i=/(\r\n)|(\r)|(\n)/.exec(n),o=i&&i[0];n=n.split(o).map(function(e){return r+e}).join(o)}return t&&(n=r+"// source "+e.uri.file+io.env.newLine+n),n}function n(e){if(a.test(e)===!1)return null;for(var r,t,n,i=e.split(/\r\n|\n|\r/g),o=[],s=i.length,l=0;s>l;l++)if(a.test(i[l])){for(t=n=l+1,r=i[l].replace("source","end:source");s>++n&&i[n]!==r;);if(n===s)return logger.error("<map:imports> Ending was not found",{ending:r}),null;o.push({file:i[l].replace(/[ \t]*\/\/[ \t]*source/g,""),start:t,end:n-1})}return o}function i(e,r){if(null==e)return null;for(var t,n,i=0,o=e.length;o>i;i++)if(n=e[i],r>=n.start&&n.end>=r){if(null==t){t=n;continue}n.start>t.start&&(t=n)}return t}io.File.middleware.importer=e;var o=/^[\t ]*\/\/[ ]*import[ ]+(([^\s'"]+)|('|"([^'"]+))'|")[ \t]*$/gm,a=/^[\t ]*\/\/[ ]*source[ ]+(([^\s'"]+)|('|"([^'"]+))'|")[ \t]*$/gm;e.map_parse=n,e.map_getFileAt=i}(),function(){var e;io.File.middleware.yml={read:function(r){null==e&&(e=require("yamljs")),"string"!=typeof r.content&&(r.content=""+r.content);try{var t=r.content.replace(/\t/g,"  ");r.content=e.parse(t)}catch(n){logger.error("<yaml:parse> ",n)}},write:function(r){null==e&&(e=require("yamljs")),null!=r.content&&"object"==typeof r.content&&(r.content=e.stringify(JSON.parse(JSON.stringify(r.content)),4))}}}(),function(){io.File.middleware.json={read:function(e){if("string"==typeof e.content)try{e.content=JSON.parse(e.content)}catch(r){logger.error("<json:parser>",r)}},write:function(e,r){if(null!=e.content&&"object"==typeof e.content)try{var t=r&&r.minify?null:4;e.content=JSON.stringify(e.content,null,t).replace(/\n/g,io.env.newLine)}catch(n){logger.error("<json:stringify> ",n)}}}}(),io.File.registerExtensions=registerMiddleware,registerMiddleware({js:["condcomments:read","hint:read","uglify:write"],css:["cssmin:write"],coffee:["coffee:read","hint:read","uglify:write"],less:["less:read","cssmin:write"],yml:["yml:read","yml:write"],json:["json:read","json:write"]})}(),io.glob={matchPath:glob_matchPath},io.settings=function(e){e.extensions&&io.File.registerExtensions(e)},null!=exports.io&&"object"==typeof exports.io?(obj_extend(exports.io,io),void 0):(exports.io=io,void 0)});